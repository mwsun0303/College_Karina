# ğŸ‘¥ Team Project ì¹´ë¦¬ë‚˜ ëŒ€í•™êµ

# ğŸ’¡ í”„ë¡œì íŠ¸ ê°œìš”.
![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%201.png)
![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled.png)

---

### ğŸ”— **GitHub**

[mwsun0303 - Repositories](https://github.com/mwsun0303?tab=repositories)

- ê¸°ëŠ¥ ë³„ íŠ¸ë˜í”½ ëŒ€ì‘ì„ ëª©ì ìœ¼ë¡œ MSA í˜•íƒœë¡œ ë¶„ë¦¬ëœ í”„ë¡œì íŠ¸ êµ¬ì¶•
    - **College_Student_Code** : í•™ìƒ ê´€ë¦¬, ê´€ë¦¬ì ê¸°ëŠ¥ êµ¬í˜„ ì½”ë“œ
    - **College_Subject_Code** : ìˆ˜ê°•ê³¼ëª© ê´€ë¦¬, ìˆ˜ê°•ì‹ ì²­ êµ¬í˜„ ì½”ë“œ
    - **College_Student_Chart** : í•™ìƒ ê´€ë¦¬ ì½”ë“œ Argo CD ë°°í¬ Helm Chart 
    - **College_Subject_Chart** : ìˆ˜ê°•ê³¼ëª© ê´€ë¦¬ ì½”ë“œ ì½”ë“œ Argo CD ë°°í¬ Helm Chart

---
- ğŸ‘¥ **ì¸ì› : 4ì¸**
- **ğŸ“…  í”„ë¡œì íŠ¸ ê¸°ê°„ : 2023.12.27 ~ 2024.02.06 (ì•½ 6ì£¼)**
- **ğŸ”  í”„ë¡œì íŠ¸ ëª©ì **
    - ëŒ€í•™êµ ìˆ˜ê°•ì‹ ì²­ ê¸°ê°„ì— ê¸‰ì¦í•˜ëŠ” ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ì— ëŒ€ì‘í•˜ì—¬ ì •ìƒì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ìˆë„ë¡ AWS Cloudì™€ Kubernetesë¥¼ í™œìš©í•œ ê³ ê°€ìš©ì„± ëŒ€í•™êµ ì›¹ ì„œë¹„ìŠ¤ êµ¬ì¶• í”„ë¡œì íŠ¸
- **ğŸ’¡  ì—­í• **
    - ê¸°íš (PL)
    - DB Table ì„¤ê³„
    - ê°œë°œ (í•™ìƒ ê°œì¸ ìˆ˜ê°• ì‹œê°„í‘œ í˜ì´ì§€)
    - Architecture ì„¤ê³„
    - CI/CD êµ¬ì¶•
    - Kubernetes í™˜ê²½ êµ¬ì„±



---

# ğŸ’¡ í”„ë¡œì íŠ¸ í™˜ê²½.

## Language.

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/JAVA.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/JAVA.jpg" width="40px" /> **Java**

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/STS.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/STS.jpg" width="40px" /> **Spring (Maven)**

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/JS.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/JS.png" width="40px" /> **Java Script**

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Terraform.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Terraform.jpg" width="40px" /> **Terraform**

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/VSCode.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/VSCode.jpg" width="40px" /> **VS Code**

</aside>

## DataBase.

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/MariaDB.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/MariaDB.jpg" width="40px" /> MariaDB

</aside>

## Tech.

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Git_Action.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Git_Action.png" width="40px" /> GitHub Action

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/%25EC%25BF%25A0%25EB%25B2%2584%25EB%2584%25A4%25ED%258B%25B0%25EC%258A%25A4.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/%25EC%25BF%25A0%25EB%25B2%2584%25EB%2584%25A4%25ED%258B%25B0%25EC%258A%25A4.png" width="40px" /> Kubernetes

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Hlem.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Hlem.png" width="40px" /> Helm

</aside>

## Tool.

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/AWS.jpg" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/AWS.jpg" width="40px" /> AWS Cloud

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Argo_CD.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Argo_CD.png" width="40px" /> ArgoCD

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Prometheus.png" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Prometheus.png" width="40px" /> **Prometheus**

</aside>

<aside>
<img src="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Grafana.jfif" alt="https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Grafana.jfif" width="40px" /> Grafana

</aside>



---

# ğŸ’¡Architecture.

![EKS Architecture.drawio.png](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/EKS_Architecture.drawio.png)

| No | êµ¬ë¶„ | ì‚¬ì–‘ | ì‚¬ìš©ëª©ì  |
| --- | --- | --- | --- |
| 1 | Availability Zone | ap-northeast-2a | ê³ ê°€ìš©ì„±ì„ ìœ„í•œ ê°€ìš© ì˜ì—­ ë¶„ë¦¬ |
| 2 | Availability Zone | ap-northeast-2c | ê³ ê°€ìš©ì„±ì„ ìœ„í•œ ê°€ìš© ì˜ì—­ ë¶„ë¦¬ |
| 3 | Bastion Host | t2.micro | ê´€ë¦¬ìê°€ Infra (Kubernetes) ì„¤ì • ìš© ê°€ìƒ Server |
| 4 | Worker node | t3.large | Kubernetes í™˜ê²½ êµ¬ë™ ê°€ìƒ Server |
| 5 | AWS Certificate Manager | CNAME | HTTPS (SSL) ì¸ì¦ì„œ |
| 6 | WAF | AWS Managed Rules Anonymous IP List | ìµëª… IP (VPN) ì£¼ì†Œ ì°¨ë‹¨ ì •ì±… |
| 7 | WAF | AWS Managed Rules Amazon IP Reputation List | AWS IP ì£¼ì†Œ ì°¨ë‹¨ ì •ì±… |
| 8 | Bastion Host Auto Scaling | Min 1EA ~ MAX 2EA | ì¼ë¶€ ê°€ìš© ì˜ì—­ ë¶•ê´´ ì‹œ Bastion Host ë³µêµ¬ ìš©ë„ |
| 9 | Worker Node Auto Scaling | Min 2EA ~ MAX 4EA | Container êµ¬ë™í•˜ëŠ” Worker Node ìˆ˜ëŸ‰ ì¡°ì ˆì„ í†µí•œ ê³ ê°€ìš©ì„± ìœ ì§€ |
| 10 | MariaDB | AWS RDS | AWS ì™„ì „ ê´€ë¦¬í˜• ê³ ê°€ìš©ì„± DataBase |



---

# ğŸ’¡ Database.

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%202.png)

### 1). Dark Data ë°©ì§€ ëª©ì  DataBase Table ì„¤ê³„

- ê¸°ì¤€ì´ ë˜ëŠ” í…Œì´ë¸”ë“¤ì˜ ê¸°ë³¸í‚¤ë¥¼ ê° í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¡œ ì‚¬ìš©
- **ìµœì†Œí•œì˜ ì¢…ì†ì„±ì„ í™œìš©í•˜ì—¬ DarkData ì €ì¥ ë°©ì§€**
    1. í•™ê³¼ ì‚­ì œ ì‹œ í•´ë‹¹ í•™ê³¼ì˜ ì—°ê´€ ë°ì´í„°ë¥¼ í•¨ê»˜ ì‚­ì œ 
        - í•™ê³¼ ê²Œì‹œê¸€
        - í•™ê³¼ ê³¼ëª©
        - ìˆ˜ê°• ê³¼ëª© ì¥ë°”êµ¬ë‹ˆ ë‚´ì—­
        - ìˆ˜ê°• ìŠ¤ì¼€ì¤„ ë‚´ì—­ ì‚­ì œ
    2. í•™ìƒ ì‚­ì œ ì‹œ í•´ë‹¹ í•™ìƒì˜ ì—°ê´€ ë°ì´í„°ë¥¼ í•¨ê»˜ ì‚­ì œ   
        - ìˆ˜ê°• ê³¼ëª© ì¥ë°”êµ¬ë‹ˆ
        - ìˆ˜ê°• ìŠ¤ì¼€ì¤„ ë‚´ì—­ ì‚­ì œ
    

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%203.png)

### 2). ì•ˆì •ì ì¸ ê³ ê°€ìš©ì„± ëª©ì ì˜ DataBase êµ¬ì¶•

- **EC2ë¥¼ í™œìš©í•˜ê³  Master/Slave êµ¬ì¡°ë¡œ DB ì„¤ê³„í•˜ëŠ” ë°©ì‹ì—ì„œ RDS ì‚¬ìš©ì„ ê²°ì •**
    1. ìŠ¤ì¼€ì¼ ì¡°ì •ì„ í†µí•œ ìë™ ì‚¬ìš©ëŸ‰ì— ë”°ë¥¸ ìœ ì—°í•œ í™•ì¥ ì§€ì›
    2. ì™„ì „ ê´€ë¦¬í˜• ì†”ë£¨ì…˜ìœ¼ë¡œ ê´€ë¦¬ í¬ì¸íŠ¸ ê°ì†Œ
    3. ì‹¤ì‹œê°„ì— ê°€ê¹Œìš´ ìë™ ë°±ì—…ìœ¼ë¡œ ì¬í•´ ë³µêµ¬ ì†”ë£¨ì…˜ ìˆ˜ë¦½
        - ë³µêµ¬ëœ ë°ì´í„°ì˜ ë†’ì€ ì‹ ë¢°ë„ ë³´ì¥
        - ë†’ì€ ì†ë„ì˜ ì¬í•´ ë³µêµ¬

- **ë¹„ìš©ë³´ë‹¤ ê°€ìš©ì„±ê³¼ ì•ˆì •ì„±ì— ì´ˆì ì„ ë‘” êµ¬ì¶• ì§„í–‰**



---

# ğŸ’¡ CI/CD.

### ğŸ” CI/CDì˜ ê²½ìš° Git Server + Jenkins CIì—ì„œ GitHub Action CIë¥¼ ì‚¬ìš©í•˜ê¸°ê¹Œì§€ ê³¼ì •ê³¼ ì´ìœ ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%204.png)

---

### 1). Git Server + jenkins CI ì‚¬ìš©

1. **Git Serverë¥¼ ì„ íƒí•œ ì´ìœ **
    - ì†ŒìŠ¤ ì½”ë“œì˜ ì™¸ë¶€ ë…¸ì¶œ ë°©ì§€
    - ì†ŒìŠ¤ ì½”ë“œì˜ ë‚´ë¶€ ë³´ê´€
    - ë³´í¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Build Tool, Jenkinsì˜ ì‚¬ìš© ê²½í—˜
    - On-Premiss í™˜ê²½ì˜ CI ìœ ì‚¬ ê²½í—˜

---

1. **Git Server êµ¬ì„±**
    1. AWS EC2 Instance ì‚¬ìš©, VPCë‚´ Git Server êµ¬í˜„
    2. Git ì„¤ì¹˜ 
    3. Jenkins ì„¤ì¹˜
    4. Git Serverì™€ Jenkinsì˜ ê¶Œí•œ ì¸ì¦
        - ì†ŒìŠ¤ ì½”ë“œì˜ ì†Œìœ ëŠ” **GIt Server**
        - Build ì§„í–‰ì€ **Jenkinsê°€ ì§„í–‰**
        - Build ì§„í–‰ì„ ìœ„í•´ì„  Jenkinsê°€ Git Serverì— ì¡´ì¬í•˜ëŠ” **ì†ŒìŠ¤ ì½”ë“œ ì‚¬ìš© ì‚¬ìš©ì ê¶Œí•œì´ í•„ìš”**
        - Jenkinsì˜ ê³µê°œí‚¤ë¥¼ Git Serverì˜ authorized_keys ë“±ë¡ì„ í†µí•´ ì¸ì¦
            
            ![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%205.png)
            

---

1. **ECRì„ ì„ íƒí•œ ì´ìœ **
    - ë³´ì•ˆìƒ ìœ ë¦¬í•œ  Repository ì‚¬ìš©
    - AWS ê³„ì •ê³¼ ê¶Œí•œ ë¶€ì—¬ + ì¸ì¦ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ECR ì„ íƒ

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%206.png)

### 2). Git Hub Actionì„ ì‚¬ìš©í•œ ì´ìœ 

1. **ë¶ˆí•„ìš”í•œ Resource ì‚¬ìš©, ìœ ì§€ ë¹„ìš© ê°ì†Œ**
    - Gitê³¼ Jenkinsì˜ ì„¤ì¹˜ì™€ ìš´ì˜ì„ ìœ„í•œ Instance
        - 2ê°œ ì´ìƒì˜ Buildë¥¼ ë™ì‹œì— ì§„í–‰í•˜ê¸° ìœ„í•´ ìµœì†Œ t3.large ì´ìƒì˜ Instance ì‚¬ìš©ì´ ë¶ˆê°€í”¼
        - Git Serverìš© EC2ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— **í•œ ë‹¬ ê¸°ì¤€ ì•½ 50$ì˜ ë¹„ìš© ì ˆê° íš¨ê³¼ ë°œìƒ**
    - ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ê´€í•  ì €ì¥ì†Œ
        - ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ê´€í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë³„ë„ì˜ ì €ì¥ì†Œ íƒ‘ì¬ê°€ ë¶ˆê°€í”¼

---

1. **í¸ë¦¬í•¨ ì¦ê°€**
    - CI ì‚¬ì „ êµ¬ì„± ê°ì†Œ, ê°„ë‹¨í•œ CI êµ¬ì„±ì´ ê°€ëŠ¥
        - Build Tool ë¶ˆí•„ìš”
        - WebHook ë¶ˆí•„ìš”
        - Plug In ì„¤ì¹˜ ë¶ˆí•„ìš”

---

1. **MSA í”„ë¡œì íŠ¸ ìš´ì˜**
    - ì†ŒìŠ¤ ì½”ë“œ Repositoryë³„ë¡œ ë™ì‹œì— Buildí•˜ëŠ” ë³‘ë ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥
    - ë³‘ë ¬ ì²˜ë¦¬ ì‹œ ë‚´ë¶€ ìì›ì„ í™œìš©í•˜ì§€ ì•ŠìŒ
        - Infra ìì²´ ë¶€í•˜ ë°©ì§€
        - ì•ˆì •ì„± ì¦ê°€
    - ë¶€ê°€ ê¸°ëŠ¥ ê°œë°œ í”„ë¡œì íŠ¸ì˜ í™•ì¥ì´ ìš©ì´í•¨
        - ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” CI/CD ì¦ì„¤ ê°€ëŠ¥

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%207.png)

1. **UI ì§€ì›ì„ í†µí•œ ê°€ì‹œì„± ì¦ê°€**
    - ê¸°ì¡´ Git ServerëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ì••ì¶• íŒŒì¼ í˜•íƒœì¸ Pack íŒŒì¼ë¡œ ì €ì¥ â†’ Pullì„ ë°›ì•„ë³´ê¸° ì „ê¹Œì§€ Push ìƒíƒœ í™•ì¸ ë¶ˆê°€
    - GitHubì—ì„œ Pushëœ ì†ŒìŠ¤ ì½”ë“œ í™•ì¸ ê°€ëŠ¥
        - ì†ŒìŠ¤ ì½”ë“œê°€ Pushëœ ìƒíƒœë¡œ UIì—ì„œ ìˆ˜ì • í›„ ì¦‰ì‹œ Commitì´ ê°€ëŠ¥
        - Helm Chartë¥¼ í™œìš©í•œ **ArgoCD ì—°ë™ì˜ í¸ì˜ì„± ì¦ê°€**

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%208.png)

### 3). Git Hub Action ì‚¬ìš©

1. **GitHub ì‚¬ìš©**
    - í”„ë¡œì íŠ¸ ë³„ë¡œ 2ê°€ì§€ì˜ Repository ì‚¬ìš©
        1. ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬ Repository
        2. ArgoCD ì‚¬ìš©ì„ ìœ„í•œ Helm Chart Repository
    - Git Action Flow
        1. Git Push
        2. jar image Build
        3. docker image Build
        4. Image to ECR Deploy
        5. Helm Chart ì—…ë°ì´íŠ¸
        6. ArgoCD Synk

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%209.png)

1. **ë³´ì•ˆì„ ìœ„í•œ Git Hub Secrets ì‚¬ìš©** 
    - **Secrets ë³€ìˆ˜ë¥¼ í™œìš©í•´ ì¸ì¦ì— í•„ìš”í•œ Access Keyë¥¼ ì•”í˜¸í™” + ì™¸ë¶€ ë…¸ì¶œ ë°©ì§€**
        1. AWS Access Key
            - AWS ECR Access ìš©ë„
        2. AWS Secret Key
            - AWS ECR Access ìš©ë„
        3. Git Hub Access Token
            - Helm Chart Replostory Access ìš©ë„
            - **Access Key ì™¸ë¶€ ë…¸ì¶œ ë°©ì§€**

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2010.png)

1. **Build Image Version ê´€ë¦¬ ëª©ì  Action Script ì‘ì„±**
    - Image Build
        1. jar image Build
        2. Docker Image Build
            - Build Success ì‹œ Helm Chart Update í˜¸ì¶œ
    - Helm Chart Update
        1. **Image Build ì„±ê³µ ì‹œ Image Tag ìƒì„±**
        2. Git Action Image Build ê³¼ì •ì—ì„œ ë¬´ì‘ìœ„ Hashê°’ì„ ì¶”ì¶œ
        3.  [Project Type - Version (Hashê°’)] í˜•íƒœë¡œ Image Tag ìƒì„±
        4. Image Tagë¡œ Build Image ìƒì„±
        5. Imageë¥¼ ECRë¡œ ë°°í¬
    - **Values.yaml íŒŒì¼ Replace**
        1. Pull Requestë¡œ Helm Chart Repository Action ì§„í–‰
        2. í˜„ì¬ ìƒì„±ëœ Image Tagë¡œ Replace (Auto Merge)
        3. ê°€ì¥ ìµœê·¼ì— Buildëœ Imageë¥¼ ë°°í¬
    
- **ê³ ìœ í•œ Tagëª…ì„ í†µí•´ ë°°í¬ëœ Image Version ê´€ë¦¬ê°€ ê°€ëŠ¥**

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2011.png)

### 4). ArgoCD

1. **ArgoCD êµ¬ì„±**
    - ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ Helm Chartì˜ ë‚´ìš©ì„ ì ˆëŒ€ì ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆê²Œ êµ¬ì„±
        1. Prune Resource
            - Helm Chartì˜ êµ¬ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì¦ê°€ëœ Resourceë¥¼ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
        2. Self Heal
            - Helm Chartì˜ êµ¬ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì‚­ì œëœ Resourceë¥¼ ë³µì›í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ ****
    - Deployment strategyë¥¼ Rolling Updateë¡œ ì„¤ì •
        - **ë¬´ì¤‘ë‹¨ ë°°í¬ê°€ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •**
            
            ![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2012.png)
            
    

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2013.png)

### 2. ë°°í¬ êµ¬ì„±

1. **Service ì´í•˜ ë°°í¬ ìë™í™” êµ¬ì„±**
    - IngressëŠ” ì •ì±…ì˜ ì¼ë¶€ë¼ê³  íŒë‹¨
    - ìë™í™”ë³´ë‹¤ **ê´€ë¦¬ìê°€ ì§ì ‘ ì„¤ì •í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ êµ¬ì„±**

---

1. **Service (Replicas (Pod)) êµ¬ì„±**
    - í•™ìƒ ê´€ë¦¬ ì¸¡ ëŒ€ë¹„ ìˆ˜ê°• ì‹ ì²­ ê¸°ëŠ¥ì— íŠ¸ë˜í”½ ì§‘ì¤‘ì„ ì˜ˆìƒí•˜ê³  ëŒ€ë¹„
    - ìˆ˜ê°• ê´€ë¦¬ í”„ë¡œì íŠ¸ ë°°í¬ Serviceì˜ Replicas (Pod)ì˜ ìˆ˜ëŸ‰ì„ ì—¬ìœ ë¡­ê²Œ ì„¤ì •

---

1. **hpa (Horizontal Pod Autoscaling) êµ¬ì„±**
    - ìˆ˜ê°• ê´€ë¦¬ Serviceì˜ hpaì˜ ë²”ìœ„ë¥¼ ë„“ê²Œ ì„¤ì •
    



---

# ğŸ’¡ Kubernetes.

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2014.png)

### 1). AWS EKSë¥¼ í™œìš©í•œ Kubernetes í™˜ê²½ êµ¬ì¶•

1. **Container Orchestration** 
    - Cluster : AWS EKS
    - Terraformì˜ ì™¸ë¶€ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
        - VPCì˜ Private Subnet ì‚¬ìš©
        - **IRSA (IAM Roles for Service Accounts)ë¥¼ trueë¡œ ì„¤ì •**
    

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2015.png)

1. **IRSA** 
    - **IAM Roles for Service Accounts**
    - AWS Resourceë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ Resource ê¶Œí•œê³¼ ì—­í• ì´ ì¡´ì¬í•˜ëŠ” AWS ê³„ì •ê³¼ Service Accountì˜ ì—°ë™ í•„ìš”
    - AWSì˜ â€˜Sun_Userâ€™ ê³„ì •ê³¼ Kubernetes â€˜adminâ€™ Service Account ì—°ë™

 

ğŸ’¡ **Kubernetesì—ì„œ Sun_User ê¶Œí•œìœ¼ë¡œ AWS Resource ì‚¬ìš©**

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2016.png)

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2017.png)

1. **Ingress** 
    - Ingress êµ¬í˜„
        - ì„¤ì •í•œ Ingressì˜ ì •ì±…ì„ ê¸°ëŠ¥ìœ¼ë¡œ êµ¬í˜„í•˜ê³  ì ìš©í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ LoadBalancerê°€ í•„ìš”
        - AWSì˜ albë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
    - HTTPS ì ‘ì† ì„¤ì •
        - Route53ì˜ Domainê³¼ ACM í™œìš©, HTTPS ì¸ì¦ êµ¬ì„±
        - HTTP (80ë²ˆ Port) ì ‘ê·¼ ì‹œ HTTPS(443ë²ˆ Port)ë¡œ Redirect ê·œì¹™ ì ìš©
    - Domain ì ‘ì† ì •ì±… ì„¤ì •
        - Domain ì£¼ì†Œì˜ Prefixì— ë”°ë¼ ì§€ì •ëœ Serviceì— ì ‘ì†í•˜ëŠ” Roututing ì •ì±… ì„¤ì •
        1. Prefixê°€ ë‹¤ìŒê³¼ ê°™ì„ ê²½ìš° **Student Service**ë¡œ ì ‘ì†
            - ê¸°ë³¸ ì ‘ì† ê²½ë¡œ
            - /student/~ ê²½ë¡œ
            - /admin/~ ê²½ë¡œ
        2. Prefixê°€ ë‹¤ìŒê³¼ ê°™ì„ ê²½ìš° **Subject Service**ë¡œ ì ‘ì†
            - /sugang/~ ê²½ë¡œ
        



---

# ğŸ”§ Improvement.

### ğŸ” í”„ë¡œì íŠ¸ ì¢…ë£Œ í›„ ê°œì¸ì ìœ¼ë¡œ ê°œì„ í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2018.png)

### 1). Kubernetesë¥¼ í™œìš©í•œ ëª¨ë‹ˆí„°ë§ ë„êµ¬ì˜ í™œìš©ë„ ê°œì„ 

- í”„ë¡œì íŠ¸ ê¸°ê°„ ì‹œê°„ ë¶€ì¡±ìœ¼ë¡œ ì¸í•´ ê¸‰í•˜ê²Œ êµ¬ì„±í•œ ëª¨ë‹ˆí„°ë§ êµ¬ì¡°ì˜ ì•„ì‰¬ì›€ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤.
- í”„ë¡œì íŠ¸ ì¢…ë£Œ í›„, Kubernetesë¥¼ í™œìš©í•˜ì—¬ Grafanaì˜ êµ¬ì¡°ë¥¼ ë³€ê²½í•´ì„œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2019.png)

### 2). Kubernetes, EFSë¥¼ í™œìš©í•œ Prometheus, Grafana êµ¬ì„±

1. **Kubernetesë¥¼ ì‚¬ìš©í•œ ì´ìœ **
    - ë¹„ìš© ì ˆì•½ íš¨ê³¼
        - t3.large â†’ t3.small Instance ì‚¬ì–‘ìœ¼ë¡œ Bastion Host EC2 ì‚¬ìš©
        - í•œ ë‹¬ ê¸°ì¤€ ì•½ 40$ì˜ ë¹„ìš© ì ˆì•½ íš¨ê³¼ ë°œìƒ
    - ì‹ ì†í•œ ìŠ¤ì¼€ì¼ ì¡°ì • ë° ì¬í•´ ë³µêµ¬
        - EC2 ëŒ€ë¹„ Podì˜ ì‹ ì†í•œ ì¬í•´ ë³µêµ¬
        - EC2 ëŒ€ë¹„ Podì˜ ì‹ ì†í•œ ìŠ¤ì¼€ì¼ ì¡°ì •

---

1. **EFSë¥¼ ì‚¬ìš©í•œ ì´ìœ **
    - EBSì˜ í•œê³„
        - EKSì˜ WorkerNode, EC2ì˜ EBSëŠ” ë‹¨ì¼ AZì˜ ì €ì¥ ì œí•œì´ ì¡´ì¬
        - Multi AZë¥¼ ì‚¬ìš©í•˜ëŠ” í˜„ì¬ êµ¬ì„±ì—ì„œ **ëª¨ë“  AZì˜ ì§€í‘œë¥¼ ìˆ˜ì§‘í•˜ê³  ì €ì¥í•˜ê¸° ìœ„í•´ EFS ì‚¬ìš©ì„ ê²°ì •**
        
        ---
        
    - ë‚´êµ¬ì„±ì´ ë›°ì–´ë‚œ File Systemì˜ í•„ìš”ì„±
        - Prometheus Pod ë‹¨ì ˆ ì‹œì—ë„ ì´ì „ì— ìˆ˜ì§‘í•œ ì§€í‘œì˜ ë³´ì¡´ì´ ê°€ëŠ¥

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2020.png)

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2021.png)

1. **EFS êµ¬í˜„**
    - Podì˜ Master Node (EC2 WorkerNode)ê°€ EFSë¥¼ ì ‘ê·¼í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë™ì¼í•œ Subnet, ë³´ì•ˆ ê·¸ë£¹ ì„¤ì • í•„ìš”
        - Subent, Security Group ì„¤ì •
            - Worker Nodeì™€ ë™ì¼í•œ Subnet ì‚¬ìš©
            - Worker Nodeì™€ ë™ì¼í•œ Security Group ì‚¬ìš©
    
    ---
    
    - Worker Nodeì˜ Master Node (EKS)ê°€ EFSë¥¼ ê´€ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— EFS CSI ë“œë¼ì´ë²„ ì„¤ì¹˜
        - CSI Driver ì„¤ì¹˜
            - Worker Nodeì— EFSë¥¼ íƒ‘ì¬
            - EKS Clusterì—ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì¶”ê°€ ê¸°ëŠ¥
    

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2022.png)

1. **Prometheus, Grafana êµ¬í˜„**
    - ë³„ë„ namespace ìƒì„±
    - Helm Chart í™œìš©í•˜ì—¬ êµ¬ì„±

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2023.png)

1. **PV, PVC ì„¤ì •**
- **PV** (Persistent Volume)
    - Prometheus, Grafana ì‚¬ìš© ëª©ì ì˜ Kubernetes Cluster ìì²´ ì €ì¥ ê³µê°„ (ë³¼ë¥¨) ì„¤ì •
- **PVC** (Persistent Volume Claim)
    - Cluster PVì˜ ì €ì¥ëœ ì§€í‘œë¥¼ Read, Write ê¶Œí•œìœ¼ë¡œ EFSì— Mount
    - ë‹¤ì¤‘ ê°€ìš© ì˜ì—­ì˜ ì§€í‘œë¥¼ ëª¨ë‘ ê¸°ë¡

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2024.png)

1. **Prometheus Service ë…¸ì¶œ, Grafana ì—°ë™**
- Prometheus
    - Ingress Domain ê²½ë¡œë¥¼ í™œìš©í•œ Service ë…¸ì¶œ
    - Port-Foward ì‚¬ìš©ì˜ ê²½ìš°
        - Port-Foward ì„¤ì • ì¥ë¹„ ì—°ê²° ë‹¨ì ˆ ì‹œ, ëª¨ë‹ˆí„°ë§ê³¼ ì§€í‘œ ìˆ˜ì§‘ ê³µë°± ë°œìƒ ê°€ëŠ¥ì„± ì¡´ì¬
        - ì§€ì†ì ì¸ ì§€í‘œ ìˆ˜ì§‘ì„ ìœ„í•´ domain ê²½ë¡œë¡œ Prometheus Service ì ‘ê·¼ êµ¬ì„±
- Grafana
    - ì‹œê°í™” ìë£Œì˜ ì™¸ë¶€ ë…¸ì¶œì„ ë°©ì§€í•˜ê¸° ìœ„í•´ Port-Foward í™œìš©
    

---

![Untitled](https://mwsun0303.s3.ap-northeast-2.amazonaws.com/Untitled%2025.png)

1. **Grafanaë¥¼ í™œìš©í•œ ì‹œê°í™”**
    - Prometheusê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•œ ì§€í‘œë¥¼ Templateì„ í™œìš©í•˜ì—¬ ì‹œê°í™” ìë£Œë¡œ ì œê³µ



---

# ğŸ’¡ í”„ë¡œì íŠ¸ í›„ê¸°.

### í”„ë¡œì íŠ¸ì˜ ê²°ê³¼ë³´ë‹¨ ì‹œë„ì™€ ê³¼ì •ì— ì¤‘ì ì„ ë‘” ê¸°íš

í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê³  ê¸°íš ë‹¨ê³„ë¶€í„° í”„ë¡œì íŠ¸ê°€ ëë‚  ë•Œê¹Œì§€ íŒ€ì›ë“¤ì—ê²Œ ê¾¸ì¤€í•˜ê²Œ í•œ ë§ì´ ìˆìŠµë‹ˆë‹¤.

**ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìš°ë¦¬ê°€ ì§ì ‘ í•´ë³´ëŠ” ê²½í—˜ë³´ë‹¤ ë” ë†’ì€ ê°€ì¹˜ëŠ” ì—†ë‹¤.**

ë‹¨ìˆœíˆ ì¸í„°ë„· ê²€ìƒ‰ì„ í†µí•œ êµ¬ì„±ê³¼ êµ¬í˜„ì˜ ê²°ê³¼ë³´ë‹¤ ê³¼ì •ê³¼ ì´ìœ ì— ì¤‘ì ì„ ë‘” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. 

ë‹¤ì–‘í•œ CI/CD ë°©ë²•ì„ ë¹„ë¡¯í•œ í”„ë¡œì íŠ¸ ê³¼ì •ì—ì„œ ë” ë‚˜ì€ ë°©ë²•ì„ ì¶”êµ¬í–ˆê³  ì‹¤ì œë¡œ ì—¬ëŸ¬ ì‹œë„ë¥¼ í†µí•´ ì‹œí–‰ì°©ì˜¤ë¥¼ ê²ªê³  ì„±ê³µì„ í•˜ë©´ì„œ ì´ˆê¸° ê¸°íš ì˜ë„ì™€ ë¶€í•©í•˜ê²Œ í”„ë¡œì íŠ¸ë¥¼ ë§ˆë¬´ë¦¬í–ˆìŠµë‹ˆë‹¤.

 

ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê³  ì„±ê³µì ìœ¼ë¡œ í”„ë¡œì íŠ¸ê°€ ì™„ë£Œí–ˆë‹¤ëŠ” ì„±ì·¨ê°ì„ í•¨ê»˜ ê³ ìƒí•œ íŒ€ì›ë“¤ê³¼ ë‚˜ëˆŒ ìˆ˜ ìˆì–´ì„œ ë¿Œë“¯í–ˆì§€ë§Œ í•œì •ëœ ì‹œê°„ì— êµ¬í˜„í•˜ì§€ ëª»í•œ ê¸°ëŠ¥ì— ëŒ€í•œ ì•„ì‰¬ì›€ë„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.

1. S3ë¥¼ í™œìš©í•œ ì •ì  íŒŒì¼ë“¤ ë³´ê´€, image ê²½ëŸ‰í™”
    
    jpg, css ë“± ì´ 20MB ì •ì  íŒŒì¼ë“¤ì„ Projectì˜ static ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  AWS S3ì— ì €ì¥ í›„ ê³µìœ í•´ì„œ ì‚¬ìš©í–ˆë‹¤ë©´ ì´ë¯¸ì§€ ê²½ëŸ‰í™”ë¥¼ ë…¸ë ¤ë³¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.
    
    í•˜ì§€ë§Œ ëª¨ë“  jspì˜ image ê²½ë¡œë¥¼ ìˆ˜ì •í•˜ëŠ” ì‹œê°„ ëŒ€ë¹„ ê²½ëŸ‰í™”ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” ìš©ëŸ‰ì´ í¬ì§€ ì•Šë‹¤ê³  íŒë‹¨í•´ì„œ ë‹¤ë¥¸ ê¸°ëŠ¥ êµ¬í˜„ì— ì‹œê°„ì„ ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤. 
    
2. ì‹¤ì‹œê°„ ë¡œê·¸ ìˆ˜ì§‘ ê¸°ëŠ¥ì˜ ë¶€ì¬
    - Elasticsearch
    - Fluentd
    - Kibana
    
    ìœ„ 3ê°€ì§€ Toolì„ í™œìš©í•œ EFK ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì§€ ëª»í•œ ë¶€ë¶„ì— ëŒ€í•œ ì•„ì‰¬ì›€ì´ í¬ê²Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.
    
    ì—”ì§€ë‹ˆì–´ê°€ ë°œìƒí•œ ë¬¸ì œë¥¼ ê°€ì¥ ë¹ ë¥´ê²Œ ì¸ì§€í•  ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨ì´ì ë¬¸ì œ í•´ê²° ë°©ë²•ì´ ë  ìˆ˜ ìˆëŠ” í•µì‹¬ ê¸°ëŠ¥ì´ê¸°ì— ì•„ì‰¬ì›€ìœ¼ë¡œ ë‚¨ê²¨ë‘ì§€ ì•Šê³  ê¼­ êµ¬í˜„í•´ ë³´ìëŠ” ë‹¤ìŒ ëª©í‘œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.
    

---

Â©by.bomd 2024
